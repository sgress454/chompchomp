<script type="text/javascript">
$(function(){
	$('.join-button').click(function(){
		socket.get("/game/"+$(this).attr('data-game-id')+"/sjoin", {}, function(response) {
			if (response.success) {
				document.location.href = "/play";
			}
		});
	});
});
</script>
<h3><% if (errors) { %><%=errors%><% } %></h3>
<button onclick="document.location.href='/game/new'">New game</button>
<table class="games-list">
	<thead>
		<tr>
			<th>Player One</th>
			<th>Player Two</th>
			<th>&nbsp;</th>
		</tr>
	</thead>
	<tbody>
	<% _.each(games, function(game) { %>
		<tr>
			<td><%- game.players[0] ? game.players[0].name : "---" %></td>
			<td><%- game.players[1] ? game.players[1].name : "---" %></td>
			<td>
				<% if ((game.players[0] && game.players[0].id == user.id) || (game.players[1] && game.players[1].id == user.id)) { %>
					<button class="join-button" data-game-id="<%- game.id %>">resume</button>
				<% } else if (game.players.length < 2) { %>
					<button class="join-button" data-game-id="<%- game.id %>">join</button>
				<% } else { %>
					Watch
				<% } %>
				</button>
			</td>
		</tr>
	<% }) %>
	</tbody>
</table>

